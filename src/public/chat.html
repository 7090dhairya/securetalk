<!DOCTYPE html>
<html>
<head>
  <title>Secure Talk - Chat</title>
</head>
<body>

<h2>Secure Talk</h2>

<div>
  <input id="to" placeholder="Recipient User ID" />
  <input id="message" placeholder="Type message..." />
  <button onclick="sendMessage()">Send</button>
</div>

<ul id="messages"></ul>
<script>
  async function loadMessages(otherUserId) {
    const res = await fetch("/messages/" + otherUserId);
    const messages = await res.json();

    const list = document.getElementById("messages");
    list.innerHTML = "";

    messages.forEach((msg) => {
      const li = document.createElement("li");
      li.textContent = msg.sender + " → " + msg.content;
      list.appendChild(li);
    });
  }
</script>

<script>
  const ws = new WebSocket("ws://localhost:3000");

  ws.onopen = () => {
    console.log("WebSocket connected");
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    const li = document.createElement("li");
    li.textContent = "From: " + data.from + " → " + data.text;

    document.getElementById("messages").appendChild(li);
  };

  ws.onclose = () => {
    console.log("WebSocket closed");
  };

  function sendMessage() {
    const to = document.getElementById("to").value;
    const text = document.getElementById("message").value;

    ws.send(JSON.stringify({ to, text }));

    document.getElementById("message").value = "";
  }
  async function loadMessages(otherUserId) {
  const res = await fetch("/messages/" + otherUserId);
  const messages = await res.json();

  messages.forEach((msg) => {
    const li = document.createElement("li");
    li.textContent = msg.sender + " → " + msg.content;
    document.getElementById("messages").appendChild(li);
  });
}
</script>

</body>
</html>